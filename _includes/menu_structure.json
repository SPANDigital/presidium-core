[
  {% for section in site.structure %}

  {% assign groups = site[section.collection] | group_by: "category" %}
  {% assign ungrouped_articles = site[section.collection] %}

  {% if groups.size == 1 and groups[0].name.size == 0 %}
  {
    "title" : "{{ section.title }}",
    "path" : "{{ baseurl }}{{section.path}}",
    "level" : 1,
    "articles" : [
      {% for article in ungrouped_articles %}
      {
        "title" : "{{ article.title }}",
        "path" : "{{ baseurl }}{{ section.path }}#{{ article.title | slugify}}",
        "level" : 2
      }{% if article != ungrouped_articles.last%},{% endif %}
      {% endfor %}
    ]
  }{% if section != site.menu.last%},{% endif %}

  {% else %}
  {
    "title" : "{{ section.title }}",
    "path" : "{{ baseurl }}{{ section.path }}",
    "level" : 1,
    "groups" : [
      {% for group in groups %}
      {% if group.name.size > 0 %}
      {% assign articles = site[section.collection] | where: "category", group.name %}
      {
        "title" : "{{ group.name }}",
        "path"  : "{{ baseurl }}{{ section.path }}#{{ group.name | slugify }}",
        "level" : 2,
        "articles" : [
          {% for article in articles %}
          {
            "title" : "{{ article.title }}",
            "path" : "{{ baseurl }}{{ section.path }}#{{ article.title | slugify}}",
            "level" : 3
          }{% if article != articles.last%},{% endif %}
          {% endfor %}
        ]
      }{% if group != groups.last%},{% endif %}
      {% endif %}
      {% endfor %}
    ],
    "articles" : [
      {% for grouping in groups %}
        {% if grouping.name == "" %}
          {% for article in grouping.items %}
            {
            "title" : "{{ article.title }}",
            "path" : "{{ baseurl }}{{ section.path }}#{{ article.title | slugify}}",
            "level" : 2
            }{% if article != grouping.items.last%},{% endif %}
          {% endfor %}
        {% endif %}
      {% endfor %}
    ]

  }{% if section != site.menu.last%},{% endif %}
  {% endif %}
  {% endfor %}
]
